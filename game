import streamlit as st
import random

# --- CONFIGURATION ET TRADUCTION ---
ROLES_FR = {
    "Loup-Garou": "ğŸº Tu dois dÃ©vorer les villageois sans te faire attraper.",
    "Voyante": "ğŸ”® Tu peux dÃ©couvrir l'identitÃ© d'un joueur chaque nuit.",
    "MÃ©decin": "ğŸ›¡ï¸ Tu peux protÃ©ger un joueur contre l'attaque des loups.",
    "Villageois": "ğŸ‘¨â€ğŸŒ¾ Ton but est de dÃ©busquer les loups-garous.",
    "SorciÃ¨re": "ğŸ§ª Tu as une potion de vie et une potion de mort."
}

st.set_page_config(page_title="Le MaÃ®tre du Jeu - Loup-Garou", page_icon="ğŸº")

# --- INTERFACE ENSEIGNANT (ADMIN) ---
st.title("ğŸ° Jeu du Loup-Garou")

with st.sidebar:
    st.header("âš™ï¸ ParamÃ¨tres du MaÃ®tre")
    nb_eleves = st.number_input("Nombre d'Ã©lÃ¨ves", min_value=4, max_value=40, value=15)
    nb_loups = st.slider("Nombre de Loups-Garous", 1, (nb_eleves // 3), 2)
    
    special_roles = st.multiselect(
        "RÃ´les SpÃ©ciaux", 
        ["Voyante", "MÃ©decin", "SorciÃ¨re"], 
        default=["Voyante"]
    )

    if st.button("ğŸ² GÃ©nÃ©rer et MÃ©langer les RÃ´les"):
        # CrÃ©ation de la liste
        deck = ["Loup-Garou"] * nb_loups
        for role in special_roles:
            deck.append(role)
        
        # Le reste sont des villageois
        while len(deck) < nb_eleves:
            deck.append("Villageois")
            
        random.shuffle(deck)
        st.session_state['deck'] = deck
        st.session_state['assigned'] = {} # On vide les attributions
        st.success("Le deck est prÃªt !")

# --- INTERFACE Ã‰LÃˆVE ---
st.divider()
st.subheader("ğŸ“± Espace Ã‰lÃ¨ve")
nom_eleve = st.text_input("Entre ton prÃ©nom :")

if 'deck' in st.session_state:
    if nom_eleve:
        # Si l'Ã©lÃ¨ve a dÃ©jÃ  un rÃ´le, on lui redonne le mÃªme
        if nom_eleve in st.session_state['assigned']:
            role_joueur = st.session_state['assigned'][nom_eleve]
        else:
            # Sinon, on lui donne le prochain rÃ´le dispo
            if len(st.session_state['assigned']) < len(st.session_state['deck']):
                role_joueur = st.session_state['deck'][len(st.session_state['assigned'])]
                st.session_state['assigned'][nom_eleve] = role_joueur
            else:
                st.error("Plus de rÃ´les disponibles !")
                role_joueur = None

        if role_joueur:
            if st.button(f"RÃ©vÃ©ler mon rÃ´le pour {nom_eleve}"):
                st.info(f"**Ton rÃ´le est : {role_joueur}**")
                st.write(ROLES_FR[role_joueur])
else:
    st.warning("En attente que le MaÃ®tre du Jeu gÃ©nÃ¨re les rÃ´les...")
